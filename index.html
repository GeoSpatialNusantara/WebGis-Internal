<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebGIS - GeoSpatialNusantara</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/shpjs@latest/dist/shp.min.js"></script>

<style>
body{margin:0;font-family:Arial;}
#map{height:100vh;width:100vw;}

#sidebar{
position:fixed;
top:0;
right:-320px;
width:320px;
height:100%;
background:#f7f7f7;
box-shadow:-3px 0 8px rgba(0,0,0,.2);
transition:.3s;
overflow:auto;
z-index:1000;
padding:15px;
}

#sidebar.active{ right:0; }

#toggleSidebar{
position:fixed;
top:15px;
right:15px;
z-index:2000;
background:white;
border:none;
padding:8px 12px;
border-radius:6px;
cursor:pointer;
box-shadow:0 2px 6px rgba(0,0,0,.3);
}

.category{
font-weight:bold;
cursor:pointer;
margin-top:10px;
display:flex;
align-items:center;
}

.category span{
margin-right:6px;
transition:.2s;
}

.year-list{
margin-left:20px;
display:none;
}

.toggle{
width:16px;
height:16px;
border-radius:50%;
background:#ccc;
display:inline-block;
margin-right:8px;
cursor:pointer;
}

.toggle.active{ background:#1976d2; }

.layer-item{
display:flex;
align-items:center;
margin:5px 0;
cursor:pointer;
}

</style>
</head>
<body>

<div id="map"></div>

<button id="toggleSidebar">☰</button>

<div id="sidebar">
<h3>Layer</h3>

<!-- FOTO UAV -->
<div class="category" onclick="toggleCategory('uav')">
<span id="arrow-uav">▶</span>
<div class="toggle" id="cat-uav"></div>
Foto Udara UAV
</div>

<div class="year-list" id="list-uav">
<div class="layer-item">
<div class="toggle year-uav" data-year="2024"></div>2024
</div>
<div class="layer-item">
<div class="toggle year-uav" data-year="2025"></div>2025
</div>
<div class="layer-item">
<div class="toggle year-uav" data-year="2026"></div>2026
</div>
</div>

<!-- WAYPOINT -->
<div class="category">
<div class="toggle" id="waypointToggle"></div>
Waypoint
</div>

</div>

<script>

/* ================= MAP ================= */

var map = L.map('map').setView([-2,118],5);

L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
maxZoom:20
}).addTo(map);

/* ================= SIDEBAR ================= */

toggleSidebar.onclick=function(){
sidebar.classList.toggle("active");
}

/* ================= CATEGORY ================= */

function toggleCategory(id){
let list=document.getElementById("list-"+id);
let arrow=document.getElementById("arrow-"+id);
list.style.display=list.style.display==="block"?"none":"block";
arrow.innerHTML=list.style.display==="block"?"▼":"▶";
}

/* ================= LAYER DATA ================= */

let layers={
uav:{
2024:null,
2025:null,
2026:null
}
};

/* ================= LOAD SHP SAMPLE ================= */

async function loadShp(url,group,year){
const geojson = await shp(url);
layers[group][year]=L.geoJSON(geojson,{
style:{color:"#1976d2",weight:2}
});
}

/* Contoh Load (ganti dengan RAW github Anda)
loadShp("file/2024.zip","uav","2024");
*/

/* ================= TOGGLE TAHUN ================= */

document.querySelectorAll(".year-uav").forEach(btn=>{
btn.onclick=function(e){
e.stopPropagation();
let year=this.dataset.year;
this.classList.toggle("active");

if(layers.uav[year]){
if(map.hasLayer(layers.uav[year])){
map.removeLayer(layers.uav[year]);
}else{
layers.uav[year].addTo(map);
map.fitBounds(layers.uav[year].getBounds());
}
}
}
});

/* ================= TOGGLE KATEGORI ================= */

document.getElementById("cat-uav").onclick=function(e){
e.stopPropagation();
this.classList.toggle("active");

let active=this.classList.contains("active");
document.querySelectorAll(".year-uav").forEach(btn=>{
if(active){
btn.classList.add("active");
}else{
btn.classList.remove("active");
}

let year=btn.dataset.year;
if(layers.uav[year]){
if(active){
layers.uav[year].addTo(map);
}else{
map.removeLayer(layers.uav[year]);
}
}
});
};

/* ================= WAYPOINT ================= */

let waypointLayer=L.layerGroup([
L.marker([-2,118]).bindPopup("Waypoint Tengah Indonesia")
]);

document.getElementById("waypointToggle").onclick=function(){
this.classList.toggle("active");
if(map.hasLayer(waypointLayer)){
map.removeLayer(waypointLayer);
}else{
waypointLayer.addTo(map);
}
};

</script>

</body>
</html>
