<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebGIS Viewer</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 80vh; width: 100%; }
        #fileList { padding: 10px; background: #f8f8f8; }
        .file-content { white-space: pre-wrap; background: #eee; padding: 10px; margin-top:1em; }
    </style>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
</head>
<body>

<h3>Daftar Isi Repository</h3>
<div id="fileList"></div>

<div id="map"></div>

<div id="fileContents" class="file-content"></div>

<script>

// 1) Inisialisasi peta
var map = L.map("map").setView([-6.9, 107.6], 11);

// 2) Basemap OSM
var osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

// 3) Basemap Satellite
var satellite = L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png", {
    attribution: "&copy; Satellite tiles"
});

// layer switcher
L.control.layers({
    "OpenStreetMap": osm,
    "Satellite": satellite
}).addTo(map);

// 4) Geocoder Search
L.Control.geocoder({ defaultMarkGeocode: true }).addTo(map);

// 5) Ambil daftar file dari GitHub API
fetch("https://api.github.com/repos/GeoSpatialNusantara/WebGis/contents")
.then(resp => resp.json())
.then(files => {
    let container = document.getElementById("fileList");

    files.forEach(f => {
        // buat link setiap file
        const link = document.createElement("a");
        link.href = "#";
        link.textContent = f.name;
        link.style.display = "block";
        link.onclick = function() {
            // tampilkan isi file
            fetch(f.download_url)
            .then(r => r.text())
            .then(txt => {
                document.getElementById("fileContents").textContent = txt;
            });
        };
        container.appendChild(link);
    });
})
.catch(err => {
    document.getElementById("fileList").textContent = "Gagal memuat daftar file: " + err;
});

</script>
</body>
</html>
