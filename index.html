<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebGIS Auto Load GitHub</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; display:flex; font-family:Arial; }
#sidebar{
    width:350px;
    background:#f4f4f4;
    padding:15px;
    height:100vh;
    overflow:auto;
    border-right:1px solid #ccc;
}
#map{ flex:1; height:100vh; }
.file-item { margin-left:15px; }
</style>
</head>

<body>

<div id="sidebar">
    <h3>ðŸ“‚ Batimetri MBES 2025</h3>
    <div id="fileList">Loading...</div>
</div>

<div id="map"></div>

<script>

// ================== MAP ==================
var map = L.map("map").setView([-2.5,117.5],5);

var osm = L.tileLayer(
    "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
    { attribution:"Â© OpenStreetMap" }
).addTo(map);

var satellite = L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
    { attribution:"Tiles Â© Esri" }
);

L.control.layers({
    "OpenStreetMap": osm,
    "Satellite": satellite
}).addTo(map);

let activeLayers = {};

// ================== AUTO LOAD FILE LIST ==================

const repo = "GeoSpatialNusantara/WebGis";
const folderPath = "file/Batimetri MBES/2025";

fetch(`https://api.github.com/repos/${repo}/contents/${folderPath}`)
.then(res => res.json())
.then(files => {

    const container = document.getElementById("fileList");
    container.innerHTML = "";

    files.forEach(file => {

        if(file.name.endsWith(".geojson")){

            const div = document.createElement("div");
            div.className = "file-item";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";

            checkbox.onchange = function(){

                if(this.checked){

                    fetch(file.download_url)
                    .then(r => r.json())
                    .then(data => {
                        let layer = L.geoJSON(data).addTo(map);
                        activeLayers[file.name] = layer;

                        if(layer.getBounds().isValid()){
                            map.fitBounds(layer.getBounds());
                        }
                    });

                } else {

                    if(activeLayers[file.name]){
                        map.removeLayer(activeLayers[file.name]);
                        delete activeLayers[file.name];
                    }

                }

            };

            div.appendChild(checkbox);
            div.appendChild(document.createTextNode(" " + file.name));
            container.appendChild(div);
        }

    });

})
.catch(err=>{
    document.getElementById("fileList").innerHTML =
        "Gagal load folder. Pastikan repo public.";
});

</script>

</body>
</html>
